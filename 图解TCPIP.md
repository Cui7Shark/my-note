# 第1章 网络基础知识

1. OSI网络模型

- 物理层-数据链路层-网路层-传输层-会话层-表示层-应用层

1. 网络规模

- WAN 广域网                  MAN 城域网                LAN 局域网

1. 报文首部

- 计算机通信会在每一个分组上附加源主机的地址和目标主机的地址发送给通信线路，这些发送端地址、接收端地址和分组序号写入的部分称为“报文首部”，这像信封上的信息。

1. 协议分层

- 分层可以将每个层独立使用，某些分层发生变化，也不会波及整个系统。增加了系统扩展性和灵活性。细分通信的功能，更易于单独实现每个分层的协议，界定各个分层的责任和义务。

1. OSI协议与OSI参考模型

- OSI（参考模型）将通信功能划分为7个分层，称作OSI参考模型。OSI协议以OSI参考模型为基础界定了每个阶层的协议和每个阶层之间接口相关的标准。

1. OSI参考模型的各个分层的作用

- 应用层

为应用程序提供服务并规定应用程序中通信相关的细节。

- 表示层

将应用处理的信息转换为适合网路传输的格式，或将来自下一层的数据转换为上层能够处理的格式。它负责数据格式的转换。

- 会话层

负责建立和断开通信连接（数据流动的逻辑通路），以及数据的分割等数据传输相关的管理。

- 传输层

保证数据可靠传输。只在通信双方节点上进行处理，而无需在路由器上处理。

- 网络层

将数据传输到目标地址。目标地址可以是多个网络通过路由器连接而成的某个地址。因此这一层主要负责寻址和路由选择。

- 数据链路层

负责物理层面上互连的、节点之间的通信传输。

- 物理层

负责0、1比特流（0、1序列）与电压的高低、光的闪光之间的互换。

1. 传输方式的分类

- 面向有连接型
- 面向无连接型

1. 地址的层次性

- MAC地址无层次性
- IP地址具有层次性

IP地址由网络号和主机号组成。即使通信主体的IP地址不同，若主机号不同，网络号相同，说明他们处于同一网段。同处一个网段的主机也都属于同一个部门或集团组织。

# 第2章TCP/IP基础知识

1. TCP/IP的具体含义

- 它只是利用IP进行通信时所必须用到的协议群的统称。也称为TCP/IP为网际协议族。

1. TCP/IP与OSI参考模型

- ![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1666181758510-5c97e110-37ba-453f-a330-0f54a36da42f.png)
- OSI参考模型注重“通信协议必要的功能是什么”，而TCP/IP则更强调“在计算机上实现协议应该开发哪种程序”。
- IP协议的作用是将分组数据包发送到目的主机。
- 连接互联网的所有主机跟路由器必须都实现IP的功能。

1. IP

- IP是跨越网络传送数据包，使整个互联网都能收到数据的协议。使用IP地址作为主机的标识。
- IP隐含着数据链路层的功能。
- IP协议不具有重发机制。即使分组数据包未能到达对端主机也不会重发，属于非可靠性协议。

1. ICMP

- IP数据包在发送途中发生异常无法到达对端目标地址时，给发送端发送一个发生异常的通知，有时也被用来诊断网网络的健康状况。

1. ARP

- 从分组数据包的IP地址中解析出物理地址（MAC地址）的一种协议。

1. 传输层

- 传输层最主要的功能是能够让应用之间实现通信。
- TCP是一种面向有连接的传输层协议。TCP能够正确处理在传输过程中丢包、传输顺序乱掉等异常情况。TCP还能够有效利用带宽，缓解网络拥堵。
- UDP有别于TCP，它是一种面向无连接的传输层协议。UDP不会关注对端是否真的收到了传送过去的数据
- UDP常用于分组数据较少或多播、广播通信以及视频通信等多媒体领域。

1. 应用层

- TCP/IP分层中，将OSI参考模型中的会话层、表示层和应用层的功能都集中到了应用程序中实现。

1. www

- 浏览器与服务器之间通信所用的协议HTTP（超文本传输协议）。所传输数据的主要格式是HTML。
- HTTP属于OSI应用层的协议，HTML属于表示层的协议。

1. FTP文件传输
2. 远程登陆（TELBNET与SSH）
3. 网络管理（SNMP）

- 使用SNMP管理的主机、网桥、路由器等称作SNMP代理（Agent）

1. 数据包首部

- 每个分层中，都会对所发送的数据附加一个首部，在这个首部中包含了该层必要的信息，如发送的目标地址以及协议相关信息。通常，为协议提供的信息为包首部，所要发送的内容为数据。

1. 包、帧、数据报、段、消息

- 帧 -- 表示数据链路层中包的单位
- 数据包是IP和UDP等网络层以上的分层中包的单位。
- 段表示TCP数据流中的信息。
- 消息是指应用协议中数据的单位。

14.TCP/IP通信的过程--以发邮件为例子

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1666267457215-a859c453-7fed-4855-b8e3-72a599498cf9.png)

1. 分组数据包经过以太网的数据链路时的大致流程

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1666267628583-5cd059eb-60d2-4463-be41-2f2a8b66332b.png)

1. 数据包接受处理

- 包的接收流程是发送流程的逆序过程

------

# 第3章 数据链路

1. 网络拓扑

- 总线型、环型、星型、网状型、混合型等

1. MAC地址

- MAC地址用于识别数据链路中互连的节点。
- MAC地址长48比特，MAC地址一般会被烧入到ROM中，一般一个网卡的MAC地址都是唯一的。有例外情况，一台主机启动多个虚拟机，生成的虚拟网卡很难保证MAC地址是唯一的。实际上，即使MAC地址相同，只要不是同属一个数据链路就不会出现问题。

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1666355792062-0d5a2d5e-0882-4ea1-8f0c-b1fcd67ff6ba.png)

1. 半双工与全双工通信

- 半双工是指，只发送或只接收的通信方式。
- 全双工，允许在同一时间既可以发送数据也可以接受数据。

1. 环路检测技术

- 通过网桥连接网络时，一旦出现环路，数据帧会在环路中持续转发，造成网络瘫痪。
- 解决网络中的环路问题方法：
- 1）生成树方式   2）源路由法

1. VLAN

- 进行网络管理时，若遇到分散网络负载、变换部署网络设备的位置的情况，可以不必进行硬件线路的改造，带有VLAN技术的网桥，只需修改网络的结构即可。

1. PPP的帧格式

- 在每个帧的前后加上一个8位字节“01111110”用来区分帧，这一个8位字节叫做标识码（HDLC）
- ![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1666611518661-bd9db8e6-5dae-4451-a9d2-b016ab711401.png)
- 

------

# 第4章 IP协议

- IP （Internet Protocol,网际协议）
- IP（IPv4、IPv6）相当于OSI参考模型中的第三层--网络层
- 网络层的主要作用是“实现终端节点之间的通信”。这种终端节点之间的通信也叫“点对点“（end to end ）通信”。
- 数据链路层主要作用是在互连同一种数据链路的节点之间进行包传递。
- 节点：主机和路由器的统称、
- 路由器：既配有IP地址又具有路由控制能力的设备。

1. 网络层与数据链路层的关系

- ![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1666613543597-8440c745-cd34-4f88-b960-379d65f9ef72.png)
- 数据链路层提供直连两个设备之间的通信功能，但只负责某一个区间之间的通信传输，不知道最终的目标是哪，
- 而网络层IP负责将数据包发给最终的目标地址，即点对点通信。
- 数据链路层相当于车票，网络层相当于行程表，缺一不可。

## 4.2 IP基础知识

1. 路由控制

- Routing 是指将分组数据发送到最终目标地址的功能。

1. 数据链路的抽象化

- 不同数据链路有各自的最大传输单位（MTU），为解决这个问题，IP进行分片处理（IP Fragmentation），即，较大的IP包分成多个较小的IP包。分片的包到了对端目标地址以后会再被组合起来传给上一层。

1. IP面向无连接型

- 目的：简化和提速
- 在发包之前，不需要建立与对端目标地址之间的连接。

## 4.3 IP地址的基础知识

1. **IP地址的定义**

- 32位正整数表示
- 32位的IP地址以每8位为一组，分成4组，“.”隔开，再将每组数转换为十进制数。

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1666867057090-235e3926-8735-471b-886e-56a95d43fb4d.png)

- IP地址由网络和主机两部分标识组成；网络标识必须保证相互连接的每个段的地址不相重复。而相同段内相连的主机必须有相同的网络地址。IP地址的“主机标识”则不允许在同一个网段内重复出现。
- 网段不同必须配置不同的”网络标识“，同一个网段的”主机标识“必须不同。

1. **IP地址的分类**

- A类 ：首位以”0“开头，从第1位到第8位是网络标识。十进制表示0.0.0.0~127.0.0.0是A类的网络地址。后24位相当于主机标识。
- B类 ：前两位位”10“的地址，从第1位到第16位是网络标识.128.0.0.1~191.255.0.0是B类的网络地址。后16位相当于主机标识。
- C类：前三位为”110“的地址。从第1位到第24位是网络标识.192.168.0.0~239.255.255.0是C类的网络标识。后8位相当于主机标识。
- D类：前四位为”1110“的地址。从第1位到第32位是网络标识.224.0.0.0~239.255.255.255是D类的网络标识。无主机标识，常用于多播。

1. 分配IP主机地址的注意事项

- 用比特位表示主机地址时，不可全为0或全为1。

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1666869205530-62e0dd43-7f56-45aa-9c76-66f7c6bba5e4.png)

1. 广播地址

- 本地广播
- 直接广播

1. 多播

- 目的：同时发送提高效率
- 多播用来把包发送给特定组内的所有主机。可以穿透路由，还可以只给那些必要的组发送数据包。
- 使用D类地址

1. 子网掩码

- 意义：因为网络标识相同的计算机必须同属于同一个链路。实际网路架构中，一般不会在同一个链路上连接理论最大数目的计算机，因此，直接使用A类或B类地址，会浪费地址。现在，使用”子网掩码“的识别码通过子网网络地址细分出比A类、B类、C类更小粒度的网络。把原来分类中的主机地址部分用作子网地址，将原网络分为多个物理网络。

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1666871581557-f42099a8-e12d-4d89-bbbd-2e15c2c66b0c.png)

## 4.4 路由控制

1. 路由控制表的聚合

- 利用网络地址的比特分布可以有效地进行分层配置。对内即使有多个子网掩码，对外呈现的也是同一个网络地址。通过路由信息的聚合可以有效地减少路由表的条目。
- 能够缩小下路由表的大小是它最大的优势。但路由表越大，导致转发IP数据包的性能下降。

## 4.6 IPv6

- IPv6的必要性：为了根本解决IPv4地址耗尽的问题而被标准化的网际协议。
- IPv4地址长度4个8位字节，即32比特。
- IPv6的地址长度是128比特。8个16位字节。
- IPv6的特点：

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1667130539165-4d8f650e-721f-40b4-9460-ac6dbb6569ec.png)

- IPv6地址结构

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1667131003231-4bfcc2d2-1f03-4920-932b-ba4da07ea30d.png)

- 全局单播地址：世界上唯一的一个地址

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1667131264678-a9caf3be-ffe8-41bf-ba94-ad2db9fab6f2.png)

- 链路本地单播地址：同一个数据链路内唯一的地址。用于不经过路由器，在同一个链路种的通信。

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1667131393326-36fa606f-7352-4fe9-804c-b48ef0ba3a4a.png)

- 唯一本地地址：不进行互联网通信时所使用的地址。

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1667131433029-b14715b1-38fa-4745-b69c-b892f1aeb5da.png)

## 4.7 IP v4 首部

- 通过IP进行通信时，需要在数据的前面加入IP首部信息。IP首部中包含着用于IP协议进行发包控制时所有的必要信息。

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1667550189374-fe26daa5-b14d-4e0b-b008-f92f76738f5b.png)

## IPv6首部格式

IPv6为了减轻路由器的负担，省略了首部校验和字段，路由器不再需要校验和，从而也提高了包的转发效率。

- IPv6数据报格式

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1667550381164-f1fb1d10-f5ec-46bd-af9a-661942b05f74.png)

# 5. IP协议相关技术

### 5.2 DNS（Domain Name System）

- DNS可以将字符串自动转换为具体的IP地址，便于人们记忆。
- DNS系统可以有效管理主机名和IP地址之间对应关系的系统。

### DNS查询

- DNS查询流程：计算机想要访问一个网站：1.向DNS服务器查询IP地址2.DNS服务器并不知道这个网站的IP地址是啥，它向根域名服务器请求进行查询。3.根域名服务器知道这个网站的IP地址，因此把IP地址返回。

4.向网站的域名服务器查询网站的IP地址。5.将查到的IP地址返回给客户端。6.计算机开始和网站进行通信。



## 5.3 ARP

### 5.3.1

- ARP是一种解决地址问题的协议。以目标IP地址为线索，用于定位下一个应该接受数据分包的网络设备对应的MAC地址。如果目标主机不在同一个链路上时，可以通过ARP查找下一跳路由器的MAC地址。但是ARP只适用于IPv4， 不能用于IPv6。

### 5.3.2 ARP的工作机制

- ARP是借助ARP请求与ARP响应两种类型的包确定MAC地址的。
- ARP可以进行动态的地址解析。

### 5.3.4 RARP

- RARP是将ARP反过来，从MAC地址定位IP地址的一种协议。

### 5.3.5 代理ARP

- 通常ARP包会被路由器隔离，但是采用代理ARP（Proxy ARP） 的路由器可以将ARP请求转发给邻近的网段。由此，两个以上网段的节点之间可以像在同一个网段中一样进行通信。

## 5.5 DHCP

- 为了实现自动设置IP地址、统一管理IP地址分配，就产生了DHCP协议。
- DHCP中继代理，可以对不同网段的IP地址分配由一个DHCP服务器统一进行管理和运维。

## 5.6 NAT（Network Address Translator）

### 5.6.1 NAT定义

- 用于在本地网络中使用私有地址，在连接互联网时转而使用全局IP地址的技术。
- NAT-PT（NAPT-PT）:是将IPv6的首部转换为IPv4的首部的一种技术，有了这种技术，那些只有IPv6地址的主机也就能够与IPv4地址的其他主机进行通信了。

## 6.TCP与UDP

### 6.6 UDP首部的格式

- UDP首部由源端口号，目标端口号，包长和校验和组成。
- ![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1669257147241-463bc7a4-1507-4451-96c5-c210cd9fe51f.png)

### 6.7 TCP首部格式

![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1669288829241-7e399f0b-379e-4b6f-a701-b7d7082b3734.png)

源端口号：表示发送端端口号，字段长16位

目标端口号：表示接收端端口号，字段长度16位。

序列号：字段长32位。

确认应答号：字段长度32位

数据偏移

保留：为了以后扩展时使用，其长度为4位。

控制位：字段长8位。

CWR：与ECE标志都用于IP首部的ECN字段，ECE标志为1时，通知对方已将拥塞窗口缩小。

ECE：表示ECN-Echo.置为1会通知通信对方，从对方到这边的网络拥塞。

URG：该位为1时，确认应答的字段变为有效。

PSH：该位为1时，表示需要将收到的数据立刻传给上层协议。

RST：该位为1时表示TCP连接中出现异常必须强制断开连接。

SYN：用于建立连接。

FIN：该位为1时，表示今后不会再有数据发送，希望断开连接。

窗口大小：字段长16位

校验位：![img](https://cdn.nlark.com/yuque/0/2022/png/25757674/1669291506056-3ff02caa-1fd7-4bef-852a-cdbb26a7bb23.png)

紧急指针：16位，一般在暂时中断通信，或中断通信的情况下使用。

选项：用于提高TCP的传输性能

\-----------------